async function create_otc() {
    try {
        const response = await fetch('/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({"Function": "create_otc"}),
        });
        
        if (!response.ok) {
            throw new Error(`HTTP Fehler! Status: ${response.status}`);
        }

        let data;
        try {
            data = await response.json();
        } catch (jsonError) {
            throw new Error('Fehler beim Parsen der JSON-Antwort');
        }

        const qrcodeDiv = document.getElementById('mfa');
        const qrcodeButtonDiv = document.getElementById('mfa-button');
        if (qrcodeDiv && qrcodeButtonDiv) {
            qrcodeDiv.innerHTML = `<img src=${data}></p>`;
            qrcodeButtonDiv.innerHTML = '<input id="Code" name="Code" placeholder="Code"></label> <button onclick="verify_code()">Verify</button> <button onclick="window.location.reload()">Back</button>';
        }

    } catch (error) {
        console.error('Fehler bei create_otc:', error.message);
        throw error;
    }
}

async function verify_code() {
    const code = document.getElementById('Code');
    if (!code.value) {
        alert("Error. Input cant be empty");
        return;
    }
    console.log(code.value);
    const response = await fetch('/settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({"Function": "verify", "Code": code.value}),
    });
    if (!response.ok) {
        throw new Error(`HTTP Fehler! Status: ${response.status}`);
    }

    let data;
    try {
        data = await response.json();
        if (data.Response !== "Success")
            alert("Error: 2FA code invalid");
        // else
        //     clear window and replace with nice UI Box. Client success
    } catch (jsonError) {
        throw new Error('Fehler beim Parsen der JSON-Antwort');
    }
    console.log(data);
}

async function verify_custom_code() {
    console.log('hi');
    const qrcodeButtonDiv = document.getElementById('mfa-button');
    if (qrcodeButtonDiv) {
        qrcodeButtonDiv.innerHTML = '<input id="Code" name="Code" placeholder="Code"><br>\
        <button onclick="create_custom_code()">Next</button> <button onclick="window.location.reload()">Back</button>';
    }
}


// THIS IS COPIED FROM CHATGPT. CREATE OWN FRONTEND UI
async function verify_custom_code() {
    const qrcodeDiv = document.getElementById('mfa');
    const inputField = document.getElementById('Code');
    if (!inputField || !qrcodeDiv)
        return;

    const codeValue = inputField.value;
    console.log("Sende Code zur Verifizierung:", codeValue);

    try {
        const response = await fetch('/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                "Function": "verify_function",
                "Code": codeValue
            })
        });

        const data = await response.json();
        
        if (data.Response === "Success") {
            alert("Code successfully registered!");
            window.location.href = 'http://localhost:8080/settings';
            return;
        } else {
            alert("Incorrect code. Please retry!");
            inputField.value = "";
            return;
        }
    } catch (error) {
        console.error("Fehler bei der Verifizierung:", error);
        alert("Fehler beim Senden des Codes.");
    }
}

// THIS IS COPIED FROM CHATGPT. CREATE OWN FRONTEND UI
async function create_custom_code() {
    console.log("create_custom_code gestartet");
    
    const qrcodeDiv = document.getElementById('mfa');
    const qrcodeButtonDiv = document.getElementById('mfa-button');

    if (!qrcodeDiv)
        return;

    qrcodeDiv.innerHTML = '<h2>Create your 2FA custom 6 diggit code</h2>';
    if (!document.getElementById('Code')) {
        qrcodeButtonDiv.innerHTML = `
            <input id="Code" name="Code" placeholder="Code"><br>
            <button id="nextButton">Next</button>
            <button onclick="window.location.reload()">Back</button>
        `;

        const nextButton = document.getElementById('nextButton');

        // Beim ersten Klick sendet der Button den Code und wechselt zur Verifikation
        nextButton.addEventListener('click', async function firstClick() {
            const inputField = document.getElementById('Code');
            if (!inputField) return;

            const codeValue = inputField.value;
            console.log("Sende Code:", codeValue);

            try {
                const response = await fetch('/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        "Function": "create_custom",
                        "Code": codeValue
                    })
                });

                const data = await response.json();
                if (data.Response === "Success") {
                    qrcodeDiv.innerHTML = '<h2>Verify your 2FA custom 6 diggit code</h2>';
                    inputField.value = "";
                    nextButton.removeEventListener('click', firstClick);
                    nextButton.addEventListener('click', verify_custom_code);
                } else {
                    alert("Fehler beim Erstellen des Codes.");
                }
            } catch (error) {
                console.error("Fehler beim Senden:", error);
                alert("Fehler beim Senden des Codes.");
            }
        });
    }
}



async function logout() {
    delete_cookie("token");
    location.reload();
}

async function delete_cookie(name) {
    document.cookie = name  + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
}
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































// Dont copy frontend from chatgpt.





























































































































































//Looking at you gregori ðŸ™‚